<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <title>Mastodon responds with 500 to Follow request</title>
    <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158</link>
    <description>Source code: https://pastebin.com/cCnnVA0d
(imports and declaration of some variables omitted).

When I execute that code I get 500 from Mastodon and 401 from Pleroma, I&#39;m pretty sure lines 18-20 are at the fault here.

My server outputs this when sending GET requests to /users/admin (domain replaced with example.com):

    {
      &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,
      &quot;id&quot;: &quot;https://example.com/users/admin&quot;,
      &quot;name&quot;: &quot;admin&quot;,
      &quot;type&quot;: &quot;Person&quot;,
      &quot;inbox&quot;: &quot;https://example.com/users/admin/inbox&quot;,
      &quot;liked&quot;: &quot;https://example.com/users/admin/liked&quot;,
      &quot;outbox&quot;: &quot;https://example.com/users/admin/outbox&quot;,
      &quot;followers&quot;: &quot;https://example.com/users/admin/followers&quot;,
      &quot;following&quot;: &quot;https://example.com/users/admin/following&quot;,
      &quot;publicKey&quot;: {
        &quot;id&quot;: &quot;https://example.com/users/admin#main-key&quot;,
        &quot;owner&quot;: &quot;https://example.com/users/admin&quot;,
        &quot;publicKeyPem&quot;: &quot;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAq1PxyqkNEbeyRAIf7epP\n4IBPlcWIX6KV1E8IKzbWcNHAzw3f/e3ngUe9ny1R+72DZwnDU1BJ9DH2jKcLRN+G\nHGYaKLwfKthESe/gShdlLQGRMdoMTtI/QWP4RhK9opZ4Bs7WPUdvVPEzA6GaFFvs\nTeF0CTZOFBNZ7htIyYJe0UL3Anf4hsjzO+Y51BWfZrrQAXV6xlx/TWyHcaukkLmw\nQrBvyOiDmQjVtVVDvdVrFYjAt9+hjJBe645UKW0Wc03UydWFhs0evYFy9Rgp9kDr\nAAitRHCRp+PxXmw3bf/UThNTh4NCXGWRDJgYscnh17FZfCA/Le40kWvxTokXxpJ4\njQIDAQAB\n-----END PUBLIC KEY-----&quot;
      },
      &quot;preferredUsername&quot;: &quot;admin&quot;
    }

What do I do?</description>
    
    <lastBuildDate>Sun, 29 Nov 2020 14:18:51 +0000</lastBuildDate>
    <category>Server to Server</category>
    <atom:link href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss" rel="self" type="application/rss+xml" />
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[protheory8]]></dc:creator>
        <description><![CDATA[
            <p>I did receive <code>Accept</code> actually, I have a console.log on inbox right now.</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/10">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/10</link>
        <pubDate>Sun, 29 Nov 2020 14:18:51 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-10</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[grishka]]></dc:creator>
        <description><![CDATA[
            <p>Yeah that’s what it’s supposed to do. If you had a working inbox, you’d also receive an <code>Accept{Follow}</code> activity shortly after.</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/9">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/9</link>
        <pubDate>Sun, 29 Nov 2020 13:58:24 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-9</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[protheory8]]></dc:creator>
        <description><![CDATA[
            <p>Thank you! Mastodon responds with 202 now that my server has Digest header in both signature and the request itself.</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/8">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/8</link>
        <pubDate>Sun, 29 Nov 2020 07:20:53 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-8</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[grishka]]></dc:creator>
        <description><![CDATA[
            <p>For one, you’re including the <code>Digest</code> header into your signature, but not into the request itself.</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/7">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/7</link>
        <pubDate>Sat, 28 Nov 2020 23:12:22 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-7</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[protheory8]]></dc:creator>
        <description><![CDATA[
            <p>I tried generating digest header differently, didn’t work either.</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/6">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/6</link>
        <pubDate>Sat, 28 Nov 2020 17:13:39 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-6</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[protheory8]]></dc:creator>
        <description><![CDATA[
            <p>Without the digest header, Mastodon responds with non-500 status code and message that Digest header is required. As soon as I add that header, Mastodon starts responding with 500. The line 18 is probably at the fault here, I don’t really know how to generate hash correctly.</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/5">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/5</link>
        <pubDate>Fri, 27 Nov 2020 18:43:39 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-5</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[protheory8]]></dc:creator>
        <description><![CDATA[
            <p>What test do I need to do exactly? Server currently doesn’t have a lot of features, it doesn’t even have any way of creating objects, unless I hard code creation of some object like I did in that pastebin code (I do have a way of fetching objects, activities and actors through API though), so a lot of these tests don’t apply.</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/4">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/4</link>
        <pubDate>Fri, 27 Nov 2020 17:33:36 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-4</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[cjs]]></dc:creator>
        <description><![CDATA[
            <p>What is the output from <a href="https://test.activitypub.dev/" rel="noopener nofollow ugc">https://test.activitypub.dev/</a> ?</p>
<p>It will basically spew logs at you so you don’t have to test against a local instance.</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/3">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/3</link>
        <pubDate>Fri, 27 Nov 2020 16:44:05 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-3</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[vpzom]]></dc:creator>
        <description><![CDATA[
            <p>I would suggest testing against a local instance so you can look at the logs, especially for a 500</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/2">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/2</link>
        <pubDate>Fri, 27 Nov 2020 15:52:28 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-2</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
      <item>
        <title>Mastodon responds with 500 to Follow request</title>
        <dc:creator><![CDATA[protheory8]]></dc:creator>
        <description><![CDATA[
            <p>Source code: <a href="https://pastebin.com/cCnnVA0d" rel="noopener nofollow ugc">https://pastebin.com/cCnnVA0d</a><br>
(imports and declaration of some variables omitted).</p>
<p>When I execute that code I get 500 from Mastodon and 401 from Pleroma, I’m pretty sure lines 18-20 are at the fault here.</p>
<p>My server outputs this when sending GET requests to /users/admin (domain replaced with <a href="http://example.com" rel="noopener nofollow ugc">example.com</a>):</p>
<pre><code>{
  "@context": "https://www.w3.org/ns/activitystreams",
  "id": "https://example.com/users/admin",
  "name": "admin",
  "type": "Person",
  "inbox": "https://example.com/users/admin/inbox",
  "liked": "https://example.com/users/admin/liked",
  "outbox": "https://example.com/users/admin/outbox",
  "followers": "https://example.com/users/admin/followers",
  "following": "https://example.com/users/admin/following",
  "publicKey": {
    "id": "https://example.com/users/admin#main-key",
    "owner": "https://example.com/users/admin",
    "publicKeyPem": "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAq1PxyqkNEbeyRAIf7epP\n4IBPlcWIX6KV1E8IKzbWcNHAzw3f/e3ngUe9ny1R+72DZwnDU1BJ9DH2jKcLRN+G\nHGYaKLwfKthESe/gShdlLQGRMdoMTtI/QWP4RhK9opZ4Bs7WPUdvVPEzA6GaFFvs\nTeF0CTZOFBNZ7htIyYJe0UL3Anf4hsjzO+Y51BWfZrrQAXV6xlx/TWyHcaukkLmw\nQrBvyOiDmQjVtVVDvdVrFYjAt9+hjJBe645UKW0Wc03UydWFhs0evYFy9Rgp9kDr\nAAitRHCRp+PxXmw3bf/UThNTh4NCXGWRDJgYscnh17FZfCA/Le40kWvxTokXxpJ4\njQIDAQAB\n-----END PUBLIC KEY-----"
  },
  "preferredUsername": "admin"
}
</code></pre>
<p>What do I do?</p>
          <p><a href="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/1">Read full topic</a></p>
        ]]></description>
        <link>https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158/1</link>
        <pubDate>Fri, 27 Nov 2020 10:34:22 +0000</pubDate>
        <guid isPermaLink="false">socialhub.activitypub.rocks-post-1158-1</guid>
        <source url="https://socialhub.activitypub.rocks/t/mastodon-responds-with-500-to-follow-request/1158.rss">Mastodon responds with 500 to Follow request</source>
      </item>
  </channel>
</rss>
