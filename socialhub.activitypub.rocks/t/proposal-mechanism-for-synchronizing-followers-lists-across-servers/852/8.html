<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Proposal: Mechanism for synchronizing followers lists across servers - #8 - Server to Server - SocialHub</title>
    <meta name="description" content="Context
Due to software bugs (e.g., Pleroma forgetting follow relationships a while ago, Mastodon mishandling Reject on Accepted Follows for the time being, etc.), crashes, backup rollbacks, etc., state may get out of sy&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.0.beta2 - https://github.com/discourse/discourse version c39ab6c0ae3803b6a62501954ae40adb6b73d580">
<link rel="icon" type="image/png" href="../../../uploads/default/optimized/1X/b7023860b3d7df97ea10ba3c7ab11cb046a77c7a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../../uploads/default/optimized/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="../852.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://socialhub.activitypub.rocks","potentialAction":{"@type":"SearchAction","target":"https://socialhub.activitypub.rocks/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../../opensearch.xml" title="SocialHub Search">

      <link href="https://socialhub.activitypub.rocks/stylesheets/desktop_caa977791d50efc800b8ef1bcbafb8a15f082761.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop" />
      <link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_5_969dd27459c19a0b7620746a3d179b86ef033d7a.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="5"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_3_f50bf2f225326f482d56e65e93f1f047d48417a9.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_8_e3f93470fef56ec97b63f77e16779e328baab8ea.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="8"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_4_8d506fd22b761a15044193a6d4ebda5f6bde2498.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4"/>
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Proposal: Mechanism for synchronizing followers lists across servers&#39;" href="../852.rss" />
    <meta property="og:site_name" content="SocialHub" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://socialhub.activitypub.rocks/uploads/default/original/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f.png" />
<meta property="og:image" content="https://socialhub.activitypub.rocks/uploads/default/original/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f.png" />
<meta property="og:url" content="https://socialhub.activitypub.rocks/t/proposal-mechanism-for-synchronizing-followers-lists-across-servers/852/8" />
<meta name="twitter:url" content="https://socialhub.activitypub.rocks/t/proposal-mechanism-for-synchronizing-followers-lists-across-servers/852/8" />
<meta property="og:title" content="Proposal: Mechanism for synchronizing followers lists across servers" />
<meta name="twitter:title" content="Proposal: Mechanism for synchronizing followers lists across servers" />
<meta property="og:description" content="Context Due to software bugs (e.g., Pleroma forgetting follow relationships a while ago, Mastodon mishandling Reject on Accepted Follows for the time being, etc.), crashes, backup rollbacks, etc., state may get out of sync between instances, in particular regarding followers information. With Mastodon’s follower-only privacy scope, this can get particularly damaging, as receiving remote instances are asked to deliver the message to who they know to follow the poster: if that gets out of sync, th..." />
<meta name="twitter:description" content="Context Due to software bugs (e.g., Pleroma forgetting follow relationships a while ago, Mastodon mishandling Reject on Accepted Follows for the time being, etc.), crashes, backup rollbacks, etc., state may get out of sync between instances, in particular regarding followers information. With Mastodon’s follower-only privacy scope, this can get particularly damaging, as receiving remote instances are asked to deliver the message to who they know to follow the poster: if that gets out of sync, th..." />
<meta property="article:published_time" content="2020-08-04T13:29:38+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
<script src="https://socialhub.activitypub.rocks/theme-javascripts/3a68d4ddcab78e923b7c4169708a8f1deb79df66.js?__ws=socialhub.activitypub.rocks"></script>
    <header>
      <a href="https://socialhub.activitypub.rocks/">
          <img src="../../../uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png" alt="SocialHub" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="../852.html">Proposal: Mechanism for synchronizing followers lists across servers</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../../c/activitypub.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #0088CC'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>ActivityPub</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../../c/activitypub/s2s/7.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #808281'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Server to Server</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularités'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../../u/Claire.html'><span itemprop='name'>Claire</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="../852.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2020-08-04T13:29:38Z'>
              <time itemprop='dateModified' datetime='2020-08-04T14:08:58Z' class='post-time'>
                August 4, 2020,  2:08pm
              </time>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <h2>Context</h2>
<p>Due to software bugs (e.g., Pleroma forgetting follow relationships a while ago, Mastodon mishandling Reject on Accepted Follows for the time being, etc.), crashes, backup rollbacks, etc., state may get out of sync between instances, in particular regarding followers information. With Mastodon’s follower-only privacy scope, this can get particularly damaging, as receiving remote instances are asked to deliver the message to who they know to follow the poster: if that gets out of sync, then the messages may reach people that the poster expects to not have access to.</p>
<p>Therefore, a mechanism to detect synchronization issues and correct them is needed. Such a mechanism has to take into account that the full list of an account’s followers may not be public information, and should thus only consider followers residing on a specific domain.</p>
<h2>Proposal</h2>
<p>Protocol extensions and an implementation are proposed in the following Mastodon Pull Request: <a href="https://github.com/tootsuite/mastodon/pull/14510" rel="nofollow noopener">https://github.com/tootsuite/mastodon/pull/14510</a></p>
<p>The basic idea being the addition of an optional <code>collectionSynchronization</code> attribute to activities such as <code>Create</code> and <code>Announce</code> activities. This attribute, typically set on activities addressed to the author’s followers specifically, would contain one or more <code>SynchronizationItem</code> objects with the following attributes:</p>
<ul>
<li>
<code>object</code>: the identifier of the collection this is describing. This collection MUST be owned by the activity’s author. For our current purposes, it must be the activity author’s followers collection.</li>
<li>
<code>domain</code>: the domain name of the instance the message is addressed to. It can be used to catch implementation bugs or to allow implementations to inline multiple <code>SynchronizationItem</code> corresponding to different servers in a same payload (e.g. when using relays)</li>
<li>
<code>partialCollection</code>: an URI to a collection that is the subset of the <code>object</code> collection made of the URIs of objects owned by <code>domain</code>. Accessing this collection SHOULD require the request to be signed (HTTP Sigs) with an account owned by the <code>domain</code>. For security reasons, it must be on the same domain as the collection it is describing.</li>
<li>
<code>digest</code>: A <a href="https://w3c-ccg.github.io/security-vocab/#Digest" rel="nofollow noopener">Digest</a> of the <code>partialCollection</code>'s items, in alphabetical order, and joined by a newline. In the proposed implementation, SHA256 (<code>http://www.w3.org/2001/04/xmlenc#sha256</code>) is the only acceptable algorithm. Choosing a common algorithm enables caching that information on each instance as necessary.</li>
</ul>
<p>A server receiving an activity with such a <code>SynchronizationItem</code> would check that it is the intended receiver (<code>domain</code> attribute), that the <code>object</code> is indeed the author’s follower collection, check that the <code>partialCollection</code> resides on the same domain name as the author, then check the digest, and in case that digest doesn’t match, it would fetch the <code>partialCollection</code>, remove any local follower not listed there, and send an <code>Undo Follow</code> for any follower listed there that it doesn’t know to be followers.</p>
<h2>Example</h2>
<p><code>Create</code> activity:</p>
<pre><code class="lang-json">{
  "@context": [
    "https://www.w3.org/ns/activitystreams",
    "https://w3id.org/security/v1",
    {
      "toot":"http://joinmastodon.org/ns#",
      "collectionSynchronization":"toot:collectionSynchronization",
      "SynchronizationItem":"toot:SynchronizationItem",
      "partialCollection": "toot:partialCollection"
  }],
  "id": "https://social.sitedethib.com/users/Thib/statuses/1234",
  "type": "Note",
  "attributedTo": "https://social.sitedethib.com/users/Thib",
  "to": ["https://social.sitedethib.com/users/Thib/followers"],
  "content": "This is just a private toot",
  "collectionSynchronization": [
    {
      "type": "SynchronizationItem",
      "domain": "mastodon.social",
      "object": "https://social.sitedethib.com/users/Thib/followers",
      "partialCollection": "https://social.sitedethib.com/users/Thib/followers_synchronization",
      "digest": {
        "type": "Digest",
        "digestAlgorithm": "http://www.w3.org/2001/04/xmlenc#sha256",
        "digestValue": "b08ab6951c7d6cc2b91e17ebd9557da7fae02489728e9332fcb3a97748244d50"
      }
    }
  ]
}
</code></pre>
<p>Result of querying <code>https://social.sitedethib.com/users/Thib/followers_synchronization</code> (when signing the request on behalf of a mastodon.social account):</p>
<pre><code class="lang-json">{
  "@context": "https://www.w3.org/ns/activitystreams",
  "id": "https://social.sitedethib.com/users/Thib/followers?domain=mastodon.social",
  "type": "OrderedCollection",
  "orderedItems": [
    "https://mastodon.social/users/Gargron"
  ]
}
</code></pre>
        </div>

        <meta itemprop='headline' content='Proposal: Mechanism for synchronizing followers lists across servers'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

            <div class='crawler-linkback-list' itemscope itemtype='http://schema.org/ItemList'>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../../2020-12-04-socialcg-meeting/1166.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://socialhub.activitypub.rocks/t/2020-12-04-socialcg-meeting/1166'>
                      <span itemprop='name'>2020-12-04 SocialCG Meeting</span>
                    </a>
                    <meta itemprop='position' content='3'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../../2020-12-11-socialcg-meeting/1180.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://socialhub.activitypub.rocks/t/2020-12-11-socialcg-meeting/1180'>
                      <span itemprop='name'>2020-12-11 SocialCG Meeting</span>
                    </a>
                    <meta itemprop='position' content='4'>
                  </div>
                  <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
                    <a href="../../2021-01-09-socialcg-meeting-fep/1246.html" itemscope itemtype='http://schema.org/DiscussionForumPosting' itemprop='item'>
                      <meta itemprop='url' content='https://socialhub.activitypub.rocks/t/2021-01-09-socialcg-meeting-fep/1246'>
                      <span itemprop='name'>2021-01-09 SocialCG Meeting - FEP</span>
                    </a>
                    <meta itemprop='position' content='5'>
                  </div>
            </div>
      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularités'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../../u/how.html'><span itemprop='name'>how</span></a>
            
              split this topic 
          </span>

          <link itemprop="mainEntityOfPage" href="../852.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2020-12-01T17:28:33Z'>
              <time itemprop='dateModified' datetime='2020-12-01T17:28:33Z' class='post-time'>
                December 1, 2020,  5:28pm
              </time>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>39 posts were merged into an existing topic: <a href="../../fep-8fcf-followers-collection-synchronization-across-servers/1172.html">FEP-8fcf: Followers collection synchronization across servers</a></p>
        </div>

        <meta itemprop='headline' content='Proposal: Mechanism for synchronizing followers lists across servers'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularités'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../../u/how.html'><span itemprop='name'>how</span></a>
            
              closed 
          </span>

          <link itemprop="mainEntityOfPage" href="../852.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-12-01T17:28:34Z' class='post-time'>
                December 1, 2020,  5:28pm
              </time>
              <meta itemprop='dateModified' content='2020-12-01T17:28:34Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          
        </div>

        <meta itemprop='headline' content='Proposal: Mechanism for synchronizing followers lists across servers'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
