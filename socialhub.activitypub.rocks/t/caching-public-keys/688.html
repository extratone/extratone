<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Caching public keys - ActivityPub - SocialHub</title>
    <meta name="description" content="What‚Äôs the best practice for caching public keys? 
If you fetch the key every time you need it you won‚Äôt be able validate deletes to an actor, plus the cost of fetching the actor for every message. If you use the cached &amp;hellip;">
    <meta name="generator" content="Discourse 2.8.0.beta2 - https://github.com/discourse/discourse version c39ab6c0ae3803b6a62501954ae40adb6b73d580">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/b7023860b3d7df97ea10ba3c7ab11cb046a77c7a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="688.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://socialhub.activitypub.rocks","potentialAction":{"@type":"SearchAction","target":"https://socialhub.activitypub.rocks/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="SocialHub Search">

      <link href="https://socialhub.activitypub.rocks/stylesheets/desktop_caa977791d50efc800b8ef1bcbafb8a15f082761.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop" />
      <link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_5_969dd27459c19a0b7620746a3d179b86ef033d7a.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="5"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_3_f50bf2f225326f482d56e65e93f1f047d48417a9.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_8_e3f93470fef56ec97b63f77e16779e328baab8ea.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="8"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_4_8d506fd22b761a15044193a6d4ebda5f6bde2498.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4"/>
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Caching public keys&#39;" href="https://socialhub.activitypub.rocks/t/caching-public-keys/688.rss" />
    <meta property="og:site_name" content="SocialHub" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://socialhub.activitypub.rocks/uploads/default/original/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f.png" />
<meta property="og:image" content="https://socialhub.activitypub.rocks/uploads/default/original/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f.png" />
<meta property="og:url" content="https://socialhub.activitypub.rocks/t/caching-public-keys/688" />
<meta name="twitter:url" content="https://socialhub.activitypub.rocks/t/caching-public-keys/688" />
<meta property="og:title" content="Caching public keys" />
<meta name="twitter:title" content="Caching public keys" />
<meta property="og:description" content="What‚Äôs the best practice for caching public keys?  If you fetch the key every time you need it you won‚Äôt be able validate deletes to an actor, plus the cost of fetching the actor for every message. If you use the cached version you risk accepting messages signed with an old key, and rejecting messages signed with a new key.  Do we need something like: attempt to validation with cached key, and check for a newer version if that fails. Periodically check for updated keys and/or check for an update..." />
<meta name="twitter:description" content="What‚Äôs the best practice for caching public keys?  If you fetch the key every time you need it you won‚Äôt be able validate deletes to an actor, plus the cost of fetching the actor for every message. If you use the cached version you risk accepting messages signed with an old key, and rejecting messages signed with a new key.  Do we need something like: attempt to validation with cached key, and check for a newer version if that fails. Periodically check for updated keys and/or check for an update..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="3 ‚ù§" />
<meta property="article:published_time" content="2020-05-13T15:24:29+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
<script src="https://socialhub.activitypub.rocks/theme-javascripts/3a68d4ddcab78e923b7c4169708a8f1deb79df66.js?__ws=socialhub.activitypub.rocks"></script>
    <header>
      <a href="https://socialhub.activitypub.rocks/">
          <img src="../../uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png" alt="SocialHub" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="688.html">Caching public keys</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/activitypub.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #0088CC'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>ActivityPub</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/cthulahoops.html'><span itemprop='name'>cthulahoops</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="688.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-05-13T15:24:29Z' class='post-time'>
                May 13, 2020,  3:24pm
              </time>
              <meta itemprop='dateModified' content='2020-05-13T15:24:29Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>What‚Äôs the best practice for caching public keys?</p>
<p>If you fetch the key every time you need it you won‚Äôt be able validate deletes to an actor, plus the cost of fetching the actor for every message. If you use the cached version you risk accepting messages signed with an old key, and rejecting messages signed with a new key.</p>
<p>Do we need something like: attempt to validation with cached key, and check for a newer version if that fails. Periodically check for updated keys and/or check for an updated key if the cached version is too old?</p>
<p>Are there any good documents on this?</p>
        </div>

        <meta itemprop='headline' content='Caching public keys'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/mleduc.html'><span itemprop='name'>mleduc</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="688.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-05-14T08:52:34Z' class='post-time'>
                May 14, 2020,  8:52am
              </time>
              <meta itemprop='dateModified' content='2020-05-14T08:52:34Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I did not found documentation of this topic but from what I remember from some implementations (mastodon, nextcloud social) they adopted the ‚Äúrefresh on fail‚Äù strategy.</p>
<p>Periodically refreshing the user profiles might also be useful to keep other Actors‚Äôs metadata up to date too.</p>
        </div>

        <meta itemprop='headline' content='Caching public keys'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/lain.html'><span itemprop='name'>lain</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="688.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-05-15T10:05:03Z' class='post-time'>
                May 15, 2020, 10:05am
              </time>
              <meta itemprop='dateModified' content='2020-05-15T10:05:03Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>refresh on fail is what we are doing in pleroma. In general, keys don‚Äôt change much.</p>
        </div>

        <meta itemprop='headline' content='Caching public keys'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/cthulahoops.html'><span itemprop='name'>cthulahoops</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="688.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2020-05-15T12:15:53Z'>
              <time itemprop='dateModified' datetime='2020-05-15T12:19:19Z' class='post-time'>
                May 15, 2020, 12:19pm
              </time>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks! I‚Äôll implement retry on fail for now.</p>
<p>While keys don‚Äôt change often, it‚Äôs kind of concerning that an old compromised key will continue to be accepted forever. At least with retry on fail any server that receives a message with the new key should discard the old.</p>
        </div>

        <meta itemprop='headline' content='Caching public keys'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/lain.html'><span itemprop='name'>lain</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="688.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-05-15T12:23:51Z' class='post-time'>
                May 15, 2020, 12:23pm
              </time>
              <meta itemprop='dateModified' content='2020-05-15T12:23:51Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>we only keep one key around, we throw away the old one as soon as we have a new one.</p>
        </div>

        <meta itemprop='headline' content='Caching public keys'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/cthulahoops.html'><span itemprop='name'>cthulahoops</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="688.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-05-15T12:37:25Z' class='post-time'>
                May 15, 2020, 12:37pm
              </time>
              <meta itemprop='dateModified' content='2020-05-15T12:37:25Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I mean that old keys can continue to live on instances that aren‚Äôt receiving messages with the new key. In practice any instances with followers should get new key quickly, so it‚Äôs probably not a real worry. Ideally we‚Äôd attach an expiry date to keys and expect instances to re-fetch expired keys.</p>
        </div>

        <meta itemprop='headline' content='Caching public keys'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/rinpatch.html'><span itemprop='name'>rinpatch</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="688.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-05-15T15:00:29Z' class='post-time'>
                May 15, 2020,  3:00pm
              </time>
              <meta itemprop='dateModified' content='2020-05-15T15:00:29Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>In Pleroma we prevent that by forcing a key refresh every 48 hours, no matter the validity</p>
        </div>

        <meta itemprop='headline' content='Caching public keys'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
