<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Avatar updates for users who aren&#39;t followed by anyone - Server to Server - SocialHub</title>
    <meta name="description" content="Here’s my problem. 

I receive a reply to a post of someone who I follow. So I fetch the actor object for whoever made the reply and store it in my database.
The user who made the reply changes their avatar.
I don’t rece&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.0.beta2 - https://github.com/discourse/discourse version c39ab6c0ae3803b6a62501954ae40adb6b73d580">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/b7023860b3d7df97ea10ba3c7ab11cb046a77c7a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="384.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://socialhub.activitypub.rocks","potentialAction":{"@type":"SearchAction","target":"https://socialhub.activitypub.rocks/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="SocialHub Search">

      <link href="https://socialhub.activitypub.rocks/stylesheets/desktop_caa977791d50efc800b8ef1bcbafb8a15f082761.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop" />
      <link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_5_969dd27459c19a0b7620746a3d179b86ef033d7a.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="5"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_3_f50bf2f225326f482d56e65e93f1f047d48417a9.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_8_e3f93470fef56ec97b63f77e16779e328baab8ea.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="8"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_4_8d506fd22b761a15044193a6d4ebda5f6bde2498.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4"/>
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Avatar updates for users who aren&#39;t followed by anyone&#39;" href="https://socialhub.activitypub.rocks/t/avatar-updates-for-users-who-arent-followed-by-anyone/384.rss" />
    <meta property="og:site_name" content="SocialHub" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://socialhub.activitypub.rocks/uploads/default/original/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f.png" />
<meta property="og:image" content="https://socialhub.activitypub.rocks/uploads/default/original/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f.png" />
<meta property="og:url" content="https://socialhub.activitypub.rocks/t/avatar-updates-for-users-who-arent-followed-by-anyone/384" />
<meta name="twitter:url" content="https://socialhub.activitypub.rocks/t/avatar-updates-for-users-who-arent-followed-by-anyone/384" />
<meta property="og:title" content="Avatar updates for users who aren&#39;t followed by anyone" />
<meta name="twitter:title" content="Avatar updates for users who aren&#39;t followed by anyone" />
<meta property="og:description" content="Here’s my problem.   I receive a reply to a post of someone who I follow. So I fetch the actor object for whoever made the reply and store it in my database. The user who made the reply changes their avatar. I don’t receive anything because no one on my instance follows that user. When I try to load the avatar using the URL I have stored, I get a 404 because it no longer exists.  I already process the Update{Person} by first checking that the actor matches the user being updated and then simply ..." />
<meta name="twitter:description" content="Here’s my problem.   I receive a reply to a post of someone who I follow. So I fetch the actor object for whoever made the reply and store it in my database. The user who made the reply changes their avatar. I don’t receive anything because no one on my instance follows that user. When I try to load the avatar using the URL I have stored, I get a 404 because it no longer exists.  I already process the Update{Person} by first checking that the actor matches the user being updated and then simply ..." />
<meta property="article:published_time" content="2019-12-11T22:51:39+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
<script src="https://socialhub.activitypub.rocks/theme-javascripts/3a68d4ddcab78e923b7c4169708a8f1deb79df66.js?__ws=socialhub.activitypub.rocks"></script>
    <header>
      <a href="https://socialhub.activitypub.rocks/">
          <img src="../../uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png" alt="SocialHub" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="384.html">Avatar updates for users who aren&#39;t followed by anyone</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/activitypub.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #0088CC'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>ActivityPub</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/activitypub/s2s/7.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #808281'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Server to Server</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularités'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/grishka.html'><span itemprop='name'>grishka</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="384.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-11T22:51:39Z' class='post-time'>
                December 11, 2019, 10:51pm
              </time>
              <meta itemprop='dateModified' content='2019-12-11T22:51:39Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Here’s my problem.</p>
<ol>
<li>I receive a reply to a post of someone who I follow. So I fetch the actor object for whoever made the reply and store it in my database.</li>
<li>The user who made the reply changes their avatar.</li>
<li>I don’t receive anything because no one on my instance follows that user.</li>
<li>When I try to load the avatar using the URL I have stored, I get a 404 because it no longer exists.</li>
</ol>
<p>I already process the Update{Person} by first checking that the actor matches the user being updated and then simply overwrite whatever I have stored, but I don’t receive any Update activities for those users in the first place.</p>
<p>How does everyone else solve this?</p>
        </div>

        <meta itemprop='headline' content='Avatar updates for users who aren&#39;t followed by anyone'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularités'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/nightpool.html'><span itemprop='name'>nightpool</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="384.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2019-12-11T23:09:03Z'>
              <time itemprop='dateModified' datetime='2019-12-11T23:12:49Z' class='post-time'>
                December 11, 2019, 11:12pm
              </time>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>so, mastodon does two things differently that may help:</p>
<ol>
<li>
<p>we cache all images locally for privacy reasons, which means we never have the 404 problem</p>
</li>
<li>
<p>when receiving an activity, we refetch the user’s profile (including caching the avatar) if it’s been a few days since we’ve last done so.</p>
</li>
</ol>
<p>the combination of these two things mean avatars never get seriously out of date, and for the time period where they are out of date, we have the last cached value to fall back on.</p>
        </div>

        <meta itemprop='headline' content='Avatar updates for users who aren&#39;t followed by anyone'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularités'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/grishka.html'><span itemprop='name'>grishka</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="384.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2019-12-11T23:17:31Z' class='post-time'>
                December 11, 2019, 11:17pm
              </time>
              <meta itemprop='dateModified' content='2019-12-11T23:17:31Z'>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote group-mastodon" data-post="2" data-topic="384">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/nightpool/40/36_2.png" class="avatar"> nightpool:</div>
<blockquote>
<p>we cache all images locally for privacy reasons, which means we never have the 404 problem</p>
</blockquote>
</aside>
<p>I cache them too now, but I do so lazily to save space so it’s still possible for the user to change the avatar after being fetched but before that URL is followed. I also delete old files from my cache. I could probably refetch the user whenever I get 404 tho <img src="../../images/emoji/twitter/thinking.png@v=9" title=":thinking:" class="emoji" alt=":thinking:"></p>
        </div>

        <meta itemprop='headline' content='Avatar updates for users who aren&#39;t followed by anyone'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularités'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/macgirvin.html'><span itemprop='name'>macgirvin</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="384.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-18T20:09:48Z' class='post-time'>
                February 18, 2020,  8:09pm
              </time>
              <meta itemprop='dateModified' content='2020-02-18T20:09:48Z'>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>I don’t have a solution for the problem of not  sending the update to everybody in the world who might have a copy of this record, but for the sake of consistency and resolving race conditions/conflicts all Update activities have an updated time. Additionally the profile photo has its own updated time so any time you fetch the record you can determine if it’s a different photo or if you can keep the one you already have. Since nobody else does this we have to fetch the unchanged photo repeatedly anyway, but we’re keeping the updated timestamps on the photo and the actor record anyway - because it’s the right thing to do. The mere presence of an updated timestamp on the photo means that we’ll know if it <em>didn’t</em> change and save an unnecessary network fetch.</p>
        </div>

        <meta itemprop='headline' content='Avatar updates for users who aren&#39;t followed by anyone'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
