<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Data storage questions - Server to Server - SocialHub</title>
    <meta name="description" content="@nutomic and I are working on federating lemmy, and I have some questions about data storage, and replication. 
Questions on activitypub storage

User tables (at least in pleroma) seem to hold both local, and federated u&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.0.beta2 - https://github.com/discourse/discourse version c39ab6c0ae3803b6a62501954ae40adb6b73d580">
<link rel="icon" type="image/png" href="../../uploads/default/optimized/1X/b7023860b3d7df97ea10ba3c7ab11cb046a77c7a_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="../../uploads/default/optimized/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="579.html" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://socialhub.activitypub.rocks","potentialAction":{"@type":"SearchAction","target":"https://socialhub.activitypub.rocks/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="../../opensearch.xml" title="SocialHub Search">

      <link href="https://socialhub.activitypub.rocks/stylesheets/desktop_caa977791d50efc800b8ef1bcbafb8a15f082761.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop" />
      <link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_5_969dd27459c19a0b7620746a3d179b86ef033d7a.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="5"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_3_f50bf2f225326f482d56e65e93f1f047d48417a9.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="3"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_8_e3f93470fef56ec97b63f77e16779e328baab8ea.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="8"/>
<link href="https://socialhub.activitypub.rocks/stylesheets/desktop_theme_4_8d506fd22b761a15044193a6d4ebda5f6bde2498.css?__ws=socialhub.activitypub.rocks" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="4"/>
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;Data storage questions&#39;" href="579.rss" />
    <meta property="og:site_name" content="SocialHub" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://socialhub.activitypub.rocks/uploads/default/original/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f.png" />
<meta property="og:image" content="https://socialhub.activitypub.rocks/uploads/default/original/1X/8faac84234dc73d074dadaa2bcf24dc746b8647f.png" />
<meta property="og:url" content="https://socialhub.activitypub.rocks/t/data-storage-questions/579" />
<meta name="twitter:url" content="https://socialhub.activitypub.rocks/t/data-storage-questions/579" />
<meta property="og:title" content="Data storage questions" />
<meta name="twitter:title" content="Data storage questions" />
<meta property="og:description" content="@nutomic and I are working on federating lemmy, and I have some questions about data storage, and replication.  Questions on activitypub storage  User tables (at least in pleroma) seem to hold both local, and federated users. Does this mean when two activitypub instances connect, it has to pull all the other instance‚Äôs users, including their entire outboxes, into its own data storage model?  What about a users toots? Do all user toots also get pulled? Is there some standard for this? Pulling all..." />
<meta name="twitter:description" content="@nutomic and I are working on federating lemmy, and I have some questions about data storage, and replication.  Questions on activitypub storage  User tables (at least in pleroma) seem to hold both local, and federated users. Does this mean when two activitypub instances connect, it has to pull all the other instance‚Äôs users, including their entire outboxes, into its own data storage model?  What about a users toots? Do all user toots also get pulled? Is there some standard for this? Pulling all..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="4 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="6 ‚ù§" />
<meta property="article:published_time" content="2020-03-20T16:35:55+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    
<script src="https://socialhub.activitypub.rocks/theme-javascripts/3a68d4ddcab78e923b7c4169708a8f1deb79df66.js?__ws=socialhub.activitypub.rocks"></script>
    <header>
      <a href="https://socialhub.activitypub.rocks/">
          <img src="../../uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png" alt="SocialHub" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="579.html">Data storage questions</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/activitypub.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #0088CC'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>ActivityPub</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="../../c/activitypub/s2s/7.html" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #808281'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Server to Server</span>
              </span>
            </a>
            <meta itemprop="position" content="2" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/dessalines.html'><span itemprop='name'>dessalines</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="579.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-20T16:35:55Z' class='post-time'>
                March 20, 2020,  4:35pm
              </time>
              <meta itemprop='dateModified' content='2020-03-20T16:35:55Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><a class="mention" href="../../u/nutomic.html">@nutomic</a> and I are working on federating lemmy, and I have some questions about data storage, and replication.</p>
<h2>Questions on activitypub storage</h2>
<ul>
<li>User tables (at least in pleroma) seem to hold both local, and federated users. Does this mean when two activitypub instances connect, it has to pull <strong>all</strong> the other instance‚Äôs users, including their entire outboxes, into its own data storage model?
<ul>
<li>What about a users toots? Do all user toots also get pulled?</li>
<li>Is there some standard for this? Pulling all data from an instance?</li>
</ul>
</li>
<li>What if one of those users changes their profile? How to deal with mutable data? How often should this data be ‚Äúcached‚Äù?</li>
<li>Are all objects and activities posted to all instances, and replicated everywhere?</li>
<li>Many users of instance 1 are following user B on instance 2. User B toots, and that create note gets posted to the inboxes of all the users instance 1. How is this de-duped in data storage? Just by an id on the create activity? Is there maybe just a single post endpoint for all data?</li>
<li>When should OrderedCollection be used, and when UnorderedCollection?</li>
</ul>
        </div>

        <meta itemprop='headline' content='Data storage questions'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="2" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/nightpool.html'><span itemprop='name'>nightpool</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="579.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-20T17:25:05Z' class='post-time'>
                March 20, 2020,  5:25pm
              </time>
              <meta itemprop='dateModified' content='2020-03-20T17:25:05Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>Does this mean when two activitypub instances connect, it has to pull <strong>all</strong> the other instance‚Äôs users, including their entire outboxes, into its own data storage model?</p>
</blockquote>
</aside>
<p>Why would this be required? What purpose does this serve? I can say that Pleroma does not do this, and i‚Äôm not sure it‚Äôs even possible without spidering or crawling the other instance in some way. (and even then you‚Äôd never be able to get everything)</p>
<aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>What if one of those users changes their profile? How to deal with mutable data? How often should this data be ‚Äúcached‚Äù?</p>
</blockquote>
</aside>
<p>I can‚Äôt speak for Pleroma, but when users change their profile on mastodon, we send out an <code>Update</code> activity to the user‚Äôs followers. I believe we also refetch the profile if we‚Äôre processing an activity from the user and we haven‚Äôt refetched the profile recently, but i‚Äôm not sure what the actual cadence is. Either way, refetching profile metadata is definitely ‚Äúbest effort‚Äù in the absence of an explicit Update activity</p>
<aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>Are all objects and activities posted to all instances, and replicated everywhere?</p>
</blockquote>
</aside>
<p>No, this is a very basic part of how ActivityPub works. Activities are posted to the <code>inbox</code> only of the actors you wish to deliver them to (In a c2s model, the actors are specified using the <code>to</code> and <code>cc</code> properties. When not implementing c2s, you can choose the <code>to</code> and <code>cc</code> properties freely based on what set of users you wish to deliver the activity to). For example, Mastodon delivers its activities to the inboxes of a user‚Äôs followers, as you can see in the targeting information below:</p>
<pre><code>
{
  "@context": "https://www.w3.org/ns/activitystreams",
  "id": "https://cybre.space/users/nightpool/statuses/102148702213596342/activity",
  "type": "Create",
  "actor": "https://cybre.space/users/nightpool",
  "published": "2019-05-24T02:38:20Z",
  <strong>"to": ["https://www.w3.org/ns/activitystreams#Public"]</strong>,
  <strong>"cc": ["https://cybre.space/users/nightpool/followers"]</strong>,
  "object": {
    ...
  }
}
</code></pre>
<aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>Many users of instance 1 are following user B on instance 2. User B toots, and that create note gets posted to the inboxes of all the users instance 1. How is this de-duped in data storage? Just by an id on the create activity? Is there maybe just a single post endpoint for all data?</p>
</blockquote>
</aside>
<ul>
<li>
<p>for <strong>data storage</strong>, there is no reason to keep multiple copies of the same note. Since all <code>ids</code> are publicly dereferencable URIs (<a href="https://www.w3.org/TR/activitypub/#obj-id">https://www.w3.org/TR/activitypub/#obj-id</a>), you can use that as your primary key in whatever data system you choose to implement</p>
</li>
<li>
<p>for <strong>delivery</strong>, you can utilize the shared inbox system, if the remote actor supports it, to reduce the amount of deliveries you need to make: <a href="https://www.w3.org/TR/activitypub/#shared-inbox-delivery">https://www.w3.org/TR/activitypub/#shared-inbox-delivery</a></p>
</li>
</ul>
<aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>When should OrderedCollection be used, and when UnorderedCollection?</p>
</blockquote>
</aside>
<p><a href="https://www.w3.org/TR/activitystreams-core/#dfn-orderedcollection">OrderedCollection</a> and <a href="https://www.w3.org/TR/activitystreams-core/#collections">Collection</a> are both part of the ActivityStreams spec, and they‚Äôre defined there. I‚Äôll quote the spec:</p>
<blockquote>
<p>The items within a <code>Collection</code> can be ordered or unordered. The <code>OrderedCollection</code> type <em>MAY</em> be used to identify a Collection whose items are always ordered. In the JSON serialization, the unordered items of a Collection are represented using the <code>items</code> property while ordered items are represented using the <code>orderedItems</code> property.</p>
</blockquote>
<p>If your Collection is ordered in any way, you should use OrderedCollection. The difference is that the <code>items</code> property on Collection gets parsed as an unordered set, while the <code>orderedItems</code> property gets parsed as an array, so unless you use <code>orderedItems</code>, other implementations might not ever retain any order information (for example, in a relational database i would represent a Collection using a simple join table, and for OrderedCollection I would add an <code>order</code> property to the table rows)</p>
<p>ActivityPub defines several properties on actors that should be <code>OrderedCollection</code>s, and several properties where it allows implementations to decide whether the items should be ordered or not. For example, an actor‚Äôs <code>inbox</code> collection should always be an <code>OrderedCollection</code>, presented in reverse chronological order: <a href="https://www.w3.org/TR/activitypub/#collections">https://www.w3.org/TR/activitypub/#collections</a>, while the <code>likes</code> collection may be ordered or unordered, as the implementation prefers: <a href="https://www.w3.org/TR/activitypub/#liked">https://www.w3.org/TR/activitypub/#liked</a>.</p>
        </div>

        <meta itemprop='headline' content='Data storage questions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/dessalines.html'><span itemprop='name'>dessalines</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="579.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2020-03-21T15:05:42Z'>
              <time itemprop='dateModified' datetime='2020-03-21T15:07:40Z' class='post-time'>
                March 21, 2020,  3:07pm
              </time>
          <span itemprop='position'>#3</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks! This is really helpful.</p>
<aside class="quote group-mastodon" data-username="nightpool" data-post="2" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/nightpool/40/36_2.png" class="avatar"> nightpool:</div>
<blockquote>
<p>Why would this be required? What purpose does this serve? I can say that Pleroma does not do this, and i‚Äôm not sure it‚Äôs even possible without spidering or crawling the other instance in some way. (and even then you‚Äôd never be able to get everything)</p>
</blockquote>
</aside>
<p>Does masto have a users table that stores federated users (from other instances). If so, how does it populate these? When it receives, lets say a <code>Create Note</code> from an actor, does it then check its local DB to see if that actor exists in its own user table, and then populate it?</p>
<aside class="quote group-mastodon" data-username="nightpool" data-post="2" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/nightpool/40/36_2.png" class="avatar"> nightpool:</div>
<blockquote>
<p>for <strong>data storage</strong> , there is no reason to keep multiple copies of the same note.</p>
</blockquote>
</aside>
<p>I‚Äôm having trouble with this part. Don‚Äôt I need to bring this data into my local data model, so that it can be queried and presented to my users?</p>
<p>Otherwise, I‚Äôd have to fetch the data on demand. This could mean my server having to do dozens of on-demand http fetches to get content.</p>
<p>And lets say its not even content that‚Äôs been posted to my users inboxes, its just their public feed. Does this mean it has to be fetched on demand?</p>
<aside class="quote group-mastodon" data-username="nightpool" data-post="2" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/nightpool/40/36_2.png" class="avatar"> nightpool:</div>
<blockquote>
<p>for <strong>delivery</strong> , you can utilize the shared inbox system, if the remote actor supports it, to reduce the amount of deliveries you need to make:</p>
</blockquote>
</aside>
<p>I wish this documented a little better. Seems like every single follow activity would have to check for other users on that same inbox‚Ä¶ and I have no idea where the sharedInbox fits in with followers collection.</p>
<p>Outside of the sharedInbox though, is the flow:</p>
<ol>
<li>A user on instance 1 creates a note, it gets posted to the inbox of all their followers.</li>
<li>A following user on instance 2 receives an inbox post, and brings that data into their local data model for querying.</li>
</ol>
        </div>

        <meta itemprop='headline' content='Data storage questions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/grishka.html'><span itemprop='name'>grishka</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="579.html">


          <span class="crawler-post-infos">
              <meta itemprop='datePublished' content='2020-03-21T23:19:08Z'>
              <time itemprop='dateModified' datetime='2020-03-21T23:24:15Z' class='post-time'>
                March 21, 2020, 11:24pm
              </time>
          <span itemprop='position'>#4</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>User tables (at least in pleroma) seem to hold both local, and federated users. Does this mean when two activitypub instances connect, it has to pull <strong>all</strong> the other instance‚Äôs users, including their entire outboxes, into its own data storage model?</p>
</blockquote>
</aside>
<p>You only pull the users as needed. For example, when you receive an activity made by an unknown user, you fetch that user and store it in your table.</p>
<p>Side note about my implementation: I decided to separate users from accounts. Every local user has an account, so there are rows in both tables for those. Every remote user only has a row in the users table because they aren‚Äôt supposed to log in to this instance.</p>
<aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>What if one of those users changes their profile? How to deal with mutable data? How often should this data be ‚Äúcached‚Äù?</p>
</blockquote>
</aside>
<p>I re-fetch the remote users whenever I receive an activity made by a user that was last fetched more than 24 hours ago.</p>
<aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>Are all objects and activities posted to all instances, and replicated everywhere?</p>
</blockquote>
</aside>
<p>No, they‚Äôre posted according to addressing (to/cc/bto/bcc fields). If there‚Äôs a followers collection, you would get the list of inboxes of the followers from your database (sharedInbox if available, otherwise simply inbox) and deduplicate it. <a href="https://github.com/grishka/Smithereen/blob/9b7e62c3b66061a6aa44421a6701d7efc8e29d9a/src/main/java/smithereen/storage/UserStorage.java#L522" rel="nofollow noopener">The way I do it that seems to be working so far.</a> For individual actors, you‚Äôd simply post the activity to that actor‚Äôs inbox or to their instance‚Äôs sharedInbox.</p>
<aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>Many users of instance 1 are following user B on instance 2. User B toots, and that create note gets posted to the inboxes of all the users instance 1. How is this de-duped in data storage? Just by an id on the create activity? Is there maybe just a single post endpoint for all data?</p>
</blockquote>
</aside>
<p>Yes. That <code>@id</code> is supposed to be unique internet-wide. Also, for the very reason to avoid posting several copies of the same activity to different inboxes on the same instance, there exists sharedInbox. If you use that, you‚Äôll only have to post one copy of your activity per instance.</p>
<aside class="quote no-group" data-username="dessalines" data-post="1" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>When should OrderedCollection be used, and when UnorderedCollection?</p>
</blockquote>
</aside>
<p>Depends on the semantics of your collection. Where the order is important (for example, outboxes where activities are sorted reverse chronologically) you‚Äôd use OrderedCollection. Otherwise, I think it‚Äôs fine to use any.</p>
        </div>

        <meta itemprop='headline' content='Data storage questions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/dessalines.html'><span itemprop='name'>dessalines</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="579.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-24T13:18:14Z' class='post-time'>
                March 24, 2020,  1:18pm
              </time>
              <meta itemprop='dateModified' content='2020-03-24T13:18:14Z'>
          <span itemprop='position'>#5</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>Thanks!</p>
<aside class="quote no-group" data-username="grishka" data-post="4" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/grishka/40/196_2.png" class="avatar"> grishka:</div>
<blockquote>
<p>I re-fetch the remote users whenever I receive an activity made by a user that was last fetched more than 24 hours ago.</p>
</blockquote>
</aside>
<p>Things like this are extremely helpful.</p>
<p>One question, what about the data that is <strong>only stored remotely</strong>, such as a remote user‚Äôs public feed. Do you fetch that data on demand, and, since its not in your local data model, do different transformations to show that data on your front end? Or do you simply not show it, and force your users to view that instance directly?</p>
<p>In my app currently, I‚Äôm only showing data on the front end that comes from my local data model, but this seems to imply that I need to be able to have a completely different path, that fetches activitypub user feeds on demand, and transform them into objects my front end can read, completely bypassing my local data model / stored data.</p>
<p>Also for both <a class="mention" href="../../u/nightpool.html">@nightpool</a> and <a class="mention" href="../../u/grishka.html">@grishka</a>, is there any more documentation for how sharedInboxes work? <a href="https://www.w3.org/TR/activitypub/#shared-inbox-delivery" rel="nofollow noopener">This doc</a> isn‚Äôt really showing how it works in practice.</p>
<p>Thanks!</p>
        </div>

        <meta itemprop='headline' content='Data storage questions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="1" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/grishka.html'><span itemprop='name'>grishka</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="579.html">

            <link itemprop="image" href="../../uploads/default/original/1X/294deda45dd79f347b001d9a8bbc4e34a56eea30.png">

          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-24T14:06:40Z' class='post-time'>
                March 24, 2020,  2:06pm
              </time>
              <meta itemprop='dateModified' content='2020-03-24T14:06:40Z'>
          <span itemprop='position'>#6</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <aside class="quote no-group" data-username="dessalines" data-post="5" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>One question, what about the data that is <strong>only stored remotely</strong> , such as a remote user‚Äôs public feed. Do you fetch that data on demand, and, since its not in your local data model, do different transformations to show that data on your front end? Or do you simply not show it, and force your users to view that instance directly?</p>
</blockquote>
</aside>
<p>This is still an open question for me. Jumping back and forth between instances isn‚Äôt a great UX ‚Äî imagine opening someone‚Äôs profile on their instance and wanting to like their post that your instance doesn‚Äôt have. Fetching all of the user‚Äôs posts in advance isn‚Äôt good because, well, you‚Äôll potentially download and store a lot of data.</p>
<p>Someone somewhere suggested fetching remote collections ‚Äúas needed‚Äù, almost proxying. That was for followers/following which won‚Äôt work for me, but it has a good chance of working for posts. Like when someone requests the next page of someone‚Äôs post feed and you don‚Äôt have it, you‚Äôd fetch it from the remote server, store it locally and then render the page.</p>
<p>Mastodon doesn‚Äôt seem to be fetching any collections for remote users at all. Not even followers/following.<br>
<div class="lightbox-wrapper"><a class="lightbox" href="../../uploads/default/original/1X/294deda45dd79f347b001d9a8bbc4e34a56eea30.png" data-download-href="https://socialhub.activitypub.rocks/uploads/default/294deda45dd79f347b001d9a8bbc4e34a56eea30" title="–°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ 2020-03-24 –≤ 16.58.19"><img src="../../uploads/default/optimized/1X/294deda45dd79f347b001d9a8bbc4e34a56eea30_2_309x499.png" alt="–°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ 2020-03-24 –≤ 16.58.19" data-base62-sha1="5ToxhL6wBRxxjrjPSLcoFlUP06Q" width="309" height="499" srcset="../../uploads/default/optimized/1X/294deda45dd79f347b001d9a8bbc4e34a56eea30_2_309x499.png, ../../uploads/default/optimized/1X/294deda45dd79f347b001d9a8bbc4e34a56eea30_2_463x748.png 1.5x, ../../uploads/default/original/1X/294deda45dd79f347b001d9a8bbc4e34a56eea30.png 2x" data-small-upload="https://socialhub.activitypub.rocks/uploads/default/optimized/1X/294deda45dd79f347b001d9a8bbc4e34a56eea30_2_10x10.png"><div class="meta">
<svg class="fa d-icon d-icon-far-image svg-icon" aria-hidden="true"><use xlink:href="#far-image"></use></svg><span class="filename">–°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ 2020-03-24 –≤ 16.58.19</span><span class="informations">598√ó965 141 KB</span><svg class="fa d-icon d-icon-discourse-expand svg-icon" aria-hidden="true"><use xlink:href="#discourse-expand"></use></svg>
</div></a></div><br>
This says ‚Äú40 following‚Äù, but only shows 4 users that are from mastodon.social, the instance I took this screenshot from.</p>
<aside class="quote no-group" data-username="dessalines" data-post="5" data-topic="579">
<div class="title">
<div class="quote-controls"></div>
<img alt width="20" height="20" src="../../user_avatar/socialhub.activitypub.rocks/dessalines/40/301_2.png" class="avatar"> dessalines:</div>
<blockquote>
<p>Also for both <a class="mention" href="../../u/nightpool.html">@nightpool</a> and <a class="mention" href="../../u/grishka.html">@grishka</a>, is there any more documentation for how sharedInboxes work? <a href="https://www.w3.org/TR/activitypub/#shared-inbox-delivery" rel="nofollow noopener">This doc</a> isn‚Äôt really showing how it works in practice.</p>
</blockquote>
</aside>
<p>I don‚Äôt think there‚Äôs any. On my server I don‚Äôt even make a distinction between the two, they‚Äôre both handled by the same code even though they‚Äôre different URLs. That said, I think <a href="https://flak.tedunangst.com/post/ActivityPub-as-it-has-been-understood" rel="nofollow noopener">this post series</a> might answer some of the questions you currently have and might have in the future.</p>
        </div>

        <meta itemprop='headline' content='Data storage questions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/Sebastian.html'><span itemprop='name'>Sebastian</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="579.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-25T09:04:16Z' class='post-time'>
                March 25, 2020,  9:04am
              </time>
              <meta itemprop='dateModified' content='2020-03-25T09:04:16Z'>
          <span itemprop='position'>#7</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>About sharedInbox, maybe this thread has some clarification.<br>
If not please add it to the guide :<br>
<a href="../introduction-to-activitypub/508.html">Introduction to ActivityPub</a></p>
<p>About</p>
<blockquote>
<p>I‚Äôm having trouble with this part. Don‚Äôt I need to bring this data into my local data model, so that it can be queried and presented to my users?</p>
</blockquote>
<p>Yes but this is only specific to your app. We talked about it in the journalism session at 36c3 and everybody handles this different apart from the ‚Äúid‚Äù. For example some only store hashtags, others store a special search index and a link index plus from/to relations.</p>
        </div>

        <meta itemprop='headline' content='Data storage questions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Petites Singularit√©s'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://socialhub.activitypub.rocks/uploads/default/original/1X/4d2bcc2cd17698f8d3efb8ffaa6983d11bbf3229.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='../../u/nedjo.html'><span itemprop='name'>nedjo</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="579.html">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-03-25T19:30:06Z' class='post-time'>
                March 25, 2020,  7:30pm
              </time>
              <meta itemprop='dateModified' content='2020-03-25T19:30:06Z'>
          <span itemprop='position'>#8</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <blockquote>
<p>is there any more documentation for how sharedInboxes work?</p>
</blockquote>
<p>See the section ‚ÄúWhat‚Äôs special about the <code>sharedInbox</code>?‚Äù in <a href="../draft-guide-for-new-activitypub-implementers/479.html" class="inline-onebox">Draft: Guide for new ActivityPub implementers</a>. Does that help?</p>
        </div>

        <meta itemprop='headline' content='Data storage questions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='https://socialhub.activitypub.rocks/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
